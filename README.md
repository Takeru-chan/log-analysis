# Log analyzer for nginx.
nginxのログ解析をするシェルスクリプトです。  

毎晩ログローテートが終わった頃にcronでこのスクリプトを動かすと解析結果をまとめたhtmlファイルが生成されます。
毎朝この結果を眺めて、怪しいアクセスがあったらすぐに対処できるようにしています。

リアルタイムでIP別にアクセスをまとめるrealtime.phpを追加。  

## 動作前提
- nginxのログフォーマットはapacheに準拠
- 前日のアクセスログが/var/log/nginx/access.log.1.gzにある
- 解析結果のhtmlファイルのドキュメントルートが/usr/local/www/search

## 解析内容
<dl>
<dt>サマリー</dt>
<dd>ボットやスパイダー、クローラーのアクセスを除いたものを有効アクセスとして、ドメインごとのアクセス数とユニークユーザー数を集計。
有効アクセス中のHTTP/2アクセス率を算出。
時間帯ごとのアクセス数を棒グラフで集計。</dd>
<dt>有効アクセスリスト</dt>
<dd>有効アクセスをIPアドレスごとにまとめて表示。</dd>
<dt>クローラーアクセス状況</dt>
<dd>ボットやスパイダー、クローラーのアクセスを集計してユーザーエージェントを表示。</dd>
<dt>POST,HEADリクエスト</dt>
<dd>GETリクエスト以外のアクセスを集計。</dd>
<dt>WordPressファイルアクセス</dt>
<dd>wp-login.phpおよびxmlrpcファイルへのアクセスを記録し、HTTPステータスとIPアドレスを集計。</dd>
<dt>非公開ドメインアクセスリスト</dt>
<dd>Webサーバーで公開設定していないドメインやIPアドレスによるアクセスを記録し、IPアドレスとHTTPステータス、被アクセスアドレスとユーザーエージェントを集計。</dd>
<dt>HTTPステータス</dt>
<dd>200以外のステータスを返したIPアドレスを集計</dd>
</dl>
